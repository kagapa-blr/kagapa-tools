<!DOCTYPE html>
<html lang="kn">
<head>
<meta charset="UTF-8">
<title>‡≤™‡≤¶‡≤æ‡≤≤‡≤Ç‡≤ï‡≤æ‡≤∞ ‡≤ï‡≥ç‡≤∞‡≤Æ-‡≤µ‡≤ø‡≤Ç‡≤ó‡≤°‡≤£‡≥Ü</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Kannada:wght@400;600&display=swap" rel="stylesheet">

<style>
    body {
        background: linear-gradient(135deg,#eaf2fe 0%,#ffefde 100%);
        font-family: 'Noto Sans Kannada', sans-serif;
    }
    .box {
        max-width: 620px;
        margin: 60px auto;
        padding: 35px 28px 32px 28px;
        background: #fff9f2;
        border-radius: 14px;
        box-shadow: 0 6px 28px rgba(100,34,0,0.08);
    }
    .kn-title {
        font-size: 2.1rem;
        font-weight: 600;
        color: #2b3755;
        margin-bottom: 8px;
        letter-spacing: 1.5px;
    }
    .kn-sub {
        font-size: 1rem;
        color: #5c6e8a;
        margin-bottom: 20px;
    }
    .drop-zone {
        border: 2.5px dashed #e5b799;
        background: #fff6ec;
        padding: 42px;
        border-radius: 10px;
        text-align: center;
        cursor: pointer;
        transition: border-color 0.2s, background 0.2s;
        color: #2a2328;
        font-size: 1.06rem;
        margin-bottom: 13px;
    }
    .drop-zone.dragover {
        background: #e0edff;
        border-color: #5175dd;
        color: #2b3755;
    }
    .progress {height:11px;border-radius:12px;margin-top:11px;}
    .progress-bar {transition:width .6s cubic-bezier(.2,1,.2,1);}
    .file-name {
        background: #f7ecd6;
        border-radius:7px;
        padding:8px;
        font-size:16px;
        color:#6a4e24;
        margin-top:8px;
        text-align:left;
        display:flex;justify-content:center;align-items:center;
        gap:8px;
    }
    .result-box {
        background: #fff;
        padding: 20px 16px;
        margin-top: 20px;
        border-radius: 10px;
        border: 1.5px solid #f3e4d9;
        font-size: 16px;
        color: #41332e;
    }
    .btn-kn {
        background: #f89036;
        border: none;
        color: #fff;
        font-weight: 600;
        border-radius: 7px;
        padding: 11px 0;
        letter-spacing: 1px;
        font-size: 1.13rem;
        box-shadow: 0 2px 6px rgba(249,144,54,0.08);
        transition: background 0.18s;
    }
    .btn-kn:hover, .btn-kn:focus {
        background: #ee7b18;
        color: #fff;
    }
    .btn-outline-kn {
        border: 1px solid #f89036;
        color: #f89036;
        font-weight: 500;
        border-radius: 7px;
        background: #fff1e5;
        transition: background .18s, color .18s;
    }
    .btn-outline-kn:hover {
        background: #f89036;
        color: #fff;
        border: 1px solid #f89036;
    }
</style>
</head>
<body>
<div class="box">
    <div class="kn-title">‡≤™‡≤¶ ‡≤ó‡≤æ‡≤§‡≥ç‡≤∞ ‡≤µ‡≤ø‡≤Ç‡≤ó‡≤°‡≤ï (DOCX/TXT)</div>
    <div class="kn-sub">‡≤´‡≥à‡≤≤‡≤®‡≥ç‡≤®‡≥Å ‡≤Ö‡≤™‡≥ç‚Äå‡≤≤‡≥ã‡≤°‡≥ç ‡≤Æ‡≤æ‡≤°‡≤ø &rarr; ‡≤™‡≤¶‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤™‡≥ç‡≤∞‡≤§‡≥ç‡≤Ø‡≥á‡≤ï‡≤ø‡≤∏‡≤ø &rarr; CSV ‡≤∞‡≥Ç‡≤™‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø ‡≤â‡≤≥‡≤ø‡≤∏‡≤ø</div>

    <div id="dropZone" class="drop-zone" tabindex="0">
        ‡≤á‡≤≤‡≥ç‡≤≤‡≤ø ‡≤´‡≥à‡≤≤‡≥çDROP‡≤Æ‡≤æ‡≤°‡≤ø ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤ï‡≥ç‡≤≤‡≤ø‡≤ï‡≥ç ‡≤Æ‡≤æ‡≤°‡≤ø<br>
        <span class="text-muted" style="font-size: 0.97rem;">(.docx, .txt ‡≤Æ‡≤æ‡≤§‡≥ç‡≤∞ ‡≤Ö‡≤®‡≥Å‡≤Æ‡≤§‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü)</span>
        <input id="fileInput" type="file" class="d-none" accept=".docx,.txt">
    </div>
    <div id="fileName" class="file-name d-none"></div>

    <button id="startBtn" class="btn btn-kn w-100 mt-3">‡≤Ö‡≤™‡≥ç‚Äå‡≤≤‡≥ã‡≤°‡≥ç ‡≤Æ‡≤æ‡≤°‡≤ø & ‡≤™‡≥ç‡≤∞‡≤ï‡≥ç‡≤∞‡≤ø‡≤Ø‡≥Ü‡≤ó‡≥ä‡≤≥‡≤ø‡≤∏‡≤ø</button>

    <div id="progressWrap" class="d-none">
        <div class="progress">
            <div id="progressBar" class="progress-bar bg-warning"></div>
        </div>
    </div>

    <div id="results" class="result-box text-muted">‡≤á‡≤®‡≥ç‡≤®‡≥Ç ‡≤´‡≤≤‡≤ø‡≤§‡≤æ‡≤Ç‡≤∂‡≤ó‡≤≥‡≥Å ‡≤á‡≤≤‡≥ç‡≤≤.</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
const dropZone = document.getElementById("dropZone");
const fileInput = document.getElementById("fileInput");
const fileNameBox = document.getElementById("fileName");
const startBtn = document.getElementById("startBtn");
const progressWrap = document.getElementById("progressWrap");
const progressBar = document.getElementById("progressBar");
const results = document.getElementById("results");

let file = null;

// Click ‚Üí browse
dropZone.addEventListener("click", () => fileInput.click());
dropZone.addEventListener("keypress", (e)=>{if(e.key===" "||e.key==="Enter"){e.preventDefault();fileInput.click();}});

fileInput.addEventListener("change", e => handleFile(e.target.files[0]));

// Drag drop
dropZone.addEventListener("dragover", e => {
    e.preventDefault();
    dropZone.classList.add("dragover");
});
dropZone.addEventListener("dragleave", () => dropZone.classList.remove("dragover"));
dropZone.addEventListener("drop", e => {
    e.preventDefault();
    dropZone.classList.remove("dragover");
    handleFile(e.dataTransfer.files[0]);
});

function handleFile(f){
    if(!f) return;
    const n = f.name.toLowerCase();
    if(!(n.endsWith(".docx") || n.endsWith(".txt"))) {
        alert("'.docx' ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å '.txt' ‡≤Æ‡≤æ‡≤§‡≥ç‡≤∞ ‡≤Ö‡≤®‡≥Å‡≤Æ‡≤§‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü");
        return;
    }
    file = f;
    fileNameBox.textContent = f.name;
    fileNameBox.classList.remove("d-none");
    fileNameBox.innerHTML = `<span>üìÑ</span> ${f.name}`;
}

// Upload
startBtn.addEventListener("click", () => {
    if(!file) return alert("‡≤Æ‡≥ä‡≤¶‡≤≤‡≥Å ‡≤´‡≥à‡≤≤‡≥ç ‡≤Ü‡≤Ø‡≥ç‡≤ï‡≥Ü‡≤Æ‡≤æ‡≤°‡≤ø");

    const fd = new FormData();
    fd.append("file", file);

    startBtn.disabled = true;
    progressWrap.classList.remove("d-none");
    progressBar.style.width = "0%";

    axios.post("/sort-doc/api/upload", fd, {
        onUploadProgress:p=>progressBar.style.width = (p.loaded/p.total*100)+"%"
    })
    .then(res=>{
        const d = res.data;
        results.innerHTML = `
            <div><b>‡≤í‡≤ü‡≥ç‡≤ü‡≥Å ‡≤™‡≤¶‡≤ó‡≤≥‡≥Å:</b> ${d.total_word_count}</div>
            <div><b>‡≤Ö‡≤¶‡≥á ‡≤∞‡≥Ä‡≤§‡≤ø‡≤Ø ‡≤™‡≤¶‡≤ó‡≤≥‡≥Å:</b> ${d.unique_word_count}</div>
            <div><b>‡≤Ö‡≤§‡≥ç‡≤Ø‡≤Ç‡≤§ ‡≤ö‡≤ø‡≤ï‡≥ç‡≤ï ‡≤™‡≤¶‡≤¶ ‡≤ó‡≤æ‡≤§‡≥ç‡≤∞:</b> ${d.min_word_length}</div>
            <div><b>‡≤Ö‡≤§‡≥ç‡≤Ø‡≤Ç‡≤§ ‡≤¶‡≥ä‡≤°‡≥ç‡≤° ‡≤™‡≤¶‡≤¶ ‡≤ó‡≤æ‡≤§‡≥ç‡≤∞:</b> ${d.max_word_length}</div>
            <div class="mt-3">
                <a class="btn btn-outline-kn w-100 mb-2" href="${d.download_lowest_url}">üì• ‡≤ö‡≤ø‡≤ï‡≥ç‡≤ï ‡≤™‡≤¶‡≤ó‡≤≥ CSV</a>
                <a class="btn btn-outline-kn w-100" href="${d.download_highest_url}">üì• ‡≤¶‡≥ä‡≤°‡≥ç‡≤° ‡≤™‡≤¶‡≤ó‡≤≥ CSV</a>
            </div>
        `;
        startBtn.disabled = false;
        progressBar.style.width = "100%";
        progressWrap.classList.add("d-none");
    })
    .catch(()=>{
        alert("‡≤Ö‡≤™‡≥ç‚Äå‡≤≤‡≥ã‡≤°‡≥ç ‡≤¶‡≥ã‡≤∑");
        startBtn.disabled = false;
        progressWrap.classList.add("d-none");
    });
});
</script>
</body>
</html>
